# 企业IT架构转型之道



# 主要问题

* 服务的注册和发现

* Nginx 高性能HTTP和反向代理服务器

* netty
 
* hession 序列化方案

* 容器化阿里容器,pouch

**最终一致性**



## 第3章 分布式服务框架的选择

* SOA(Service-Oriented Architecture)面向服务的体系结构

面向服务的架构（SOA）是一个组件模型，它将应用程序的不同功能单元（称为服务）通过这些服务之间定义良好的接口和契约联系起来。接口是采用中立的方式进行定义的，它应该独立于实现服务的硬件平台、操作系统和编程语言。这使得构建在各种各样的系统中的服务可以以一种统一和通用的方式进行交互。

* ESB

ESB全称为Enterprise Service Bus，即企业服务总线。它是传统中间件技术与XML、Web服务等技术结合的产物。ESB提供了网络中最基本的连接中枢，是构筑企业神经系统的必要元素。ESB的出现改变了传统的软件架构，可以提供比传统中间件产品更为廉价的解决方案，同时它还可以消除不同应用之间的技术差异，让不同的应用服务器协调运作，实现了不同服务之间的通信与整合。从功能上看，ESB提供了事件驱动和文档导向的处理模式，以及分布式的运行管理机制，它支持基于内容的路由和过滤，具备了复杂数据的传输能力，并可以提供一系列的标准接口。

* JMS

MS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。

* 分布式服务框架 HSF(High speed framework)

[开源的为Dubbo](https://github.com/alibaba/dubbo)

主要部件:

运行发送war包方式,集成服务发现,服务注册,订阅,失效等功能.无需引入相关包.
服务提供者:

服务调用者:

地址服务器:

配置服务器:  所有服务的发布和订阅都是保存在内存中.

配置服务器与服务提供者和调用者都是长连接.以心跳方式监控状态.

Diamond服务器: 通用的统一配置管理服务类似zoonkeeper. 为应用提供统一的配置和推送服务.

本文主要是讨论下两个类似产品：ZooKeeper和Diamond在配置管理这个应用场景上的异同点。
Diamond，顾名思义，寄寓了开发人员对产品稳定性的厚望，希望它像钻石一样，提供稳定的配置访问。Diamond是淘宝网Java中间件团队的核心产品之一，服务于集团线上很多核心应用。目前已经开源，开源地址在：http://code.taobao.org/p/diamond/wiki/index/。

数据持久性
Diamond主要针对的是持久数据，这些数据有个共同的特点是：集群中一批机器都会使用，但是数据的更新频率不大，且希望diamond能够永久存储。
ZooKeeper即可以存储持久数据，也可以存储非持久数据。持久数据和diamond中的持久数据都类似，所谓的非持久数据是指这些数据的生命周期和数据创建者的会话生命周期绑定，一旦会话结束，那么这些非持久数据也会被清除。

* 微服务

容器化有点: 能够包装,便于移植,为适用用途需要随时创建,减少资源占用,缩短启动时间.

# 第4章  共享服务中心建设原则
**四大中心**

1. 用户中心
2. 商品中心
3. 交易中心
4. 店铺中心


## 服务中心服务的多样性

1. 依赖于接口的服务
2. 依赖于工具的服务
3. 依赖于数据的服务

## 服务的拆分原则
1. 高内聚低耦合:相关放到一起
2. 数据完整性原则:相关数据放到一起                                                                                                                                                                                                                                                                         
3. 业务可运营性原则                        
4. 渐进性:小步快跑
                 


# 第五章 数据拆分实现数据库线性扩展
**数据库是最容易产生性能瓶颈的服务组件,采用分库分表解决数据库的瓶颈**

                                                                                                                                                                                                                                                                                                                                   
## 读写分离
主数据库进行 增 删 改操作,从数据库进行查.
数据库后台把主数据库的更改同步到从数据库.

主数据库的写入能力依然无法提高.

 
## 数据库的水平扩展

哈希分库分表
分库分表比较简单,但是跨表的 join,统计和排序工作无法避免.
解决方案,分布式数据库


## 数据库分库分表的实践               

尽量减少事务边界,避免全表扫描
                                                                                                                                                                                                                                                      
# 第六章 异步化与缓存原则
使用消息中间件,实现异步化.

数据库事务异步化



## ACID理论



## CAP理论:

一个分布式系统只能同时满足一致性.可用性和容错性三项中的两项.

1. 一致性(Consisitency):  更新操作成功并返回客户端后,所有节点完全一致. 操作应该同时成功或同时失败.
2. 可用性(Availability):  在访问数据时可以得到及时响应.  持续不间断使用.
3. 分区容错性(Partition tolerance):  节点或网络故障时,仍能对外提供一致性和可用性的服务. 

## BASE理论
对cap理论的延伸.

核心思想即使无法做到cap理论的强一致性但是应用可以采取,适当方式达到最终一致性.

* 基本可用: 出现工作,允许损失部分可用性.  核心可用.

* 柔性状态: 允许存在中间状态,中间状态不影响系统可用性,  一般一份数据有三个副本.

* 最终一致性: 所有副本,经过一段时间后最终都会达到一致性状态.


## 柔性事务解决分布式事务问题

1. 引入日志和补偿机制
2. 可靠消息传递
3. 实现无锁


**实现事务隔离方法:**

1. 避免事务进入回滚
2. 辅助业务变化明细表: 在表下面 增加预减或预加操作.
3. 乐观锁:基于数据版本号的记录实现.

在更新时与以前的版本号比对,版本号相同一致则直接更新.
版本号不一致时,表示已经被其他事务修改了.放弃或重试.


## 柔性事务在阿里巴巴内部的几种实现


### 消息分布式事务





### 支付宝XTS框架






# 第七章 打造数据化运营能力
# 第八章 打造平台稳定性能力
# 第九章 共享服务中心对内对外的协作共享
# 第十章 大型央企互联网转型
# 第十一章 时尚行业品牌公司互联网转型
























